<%- include('../partials/head') %>

<div class="page-header">
  <a href="/tasks" class="btn btn-outline">‚Üê Back to Tasks</a>
  <div class="header-actions">
    <a href="/tasks/<%= task._id %>/edit" class="btn btn-outline">Edit</a>
    <form action="/tasks/<%= task._id %>?_method=DELETE" method="POST" class="inline-form" onsubmit="return confirm('Are you sure you want to delete this task?')">
      <button type="submit" class="btn btn-danger">Delete</button>
    </form>
  </div>
</div>

<div class="task-detail">
  <div class="task-detail-header">
    <span class="priority-badge priority-<%= task.priority %>"><%= task.priority %> priority</span>
    <span class="status-badge status-<%= task.status %>">
      <%= task.status === 'todo' ? 'To Do' : task.status === 'in-progress' ? 'In Progress' : 'Done' %>
    </span>
  </div>
  
  <h1 class="task-detail-title"><%= task.title %></h1>
  
  <% if (task.description) { %>
    <div class="task-detail-description">
      <h3>Description</h3>
      <p><%= task.description %></p>
    </div>
  <% } %>
  
  <div class="task-detail-meta">
    <% if (task.categoryId) { %>
      <div class="meta-item">
        <span class="meta-label">Category</span>
        <span class="category-tag" style="background-color: <%= task.categoryId.color %>20; color: <%= task.categoryId.color %>; border: 1px solid <%= task.categoryId.color %>">
          <%= task.categoryId.name %>
        </span>
      </div>
    <% } %>
    
    <% if (task.dueDate) { %>
      <div class="meta-item">
        <span class="meta-label">Due Date</span>
        <span class="<%= new Date(task.dueDate) < new Date() && task.status !== 'done' ? 'overdue' : '' %>">
          <%= new Date(task.dueDate).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %>
        </span>
      </div>
    <% } %>
    
    <div class="meta-item">
      <span class="meta-label">Created</span>
      <span><%= new Date(task.createdAt).toLocaleDateString() %></span>
    </div>
    
    <% if (task.updatedAt.toString() !== task.createdAt.toString()) { %>
      <div class="meta-item">
        <span class="meta-label">Last Updated</span>
        <span><%= new Date(task.updatedAt).toLocaleDateString() %></span>
      </div>
    <% } %>
  </div>
  
  <div class="task-detail-actions">
    <h3>Quick Actions</h3>
    <form action="/tasks/<%= task._id %>/status?_method=PATCH" method="POST" class="quick-status-form">
      <% if (task.status !== 'todo') { %>
        <button type="submit" name="status" value="todo" class="btn btn-outline">Mark as To Do</button>
      <% } %>
      <% if (task.status !== 'in-progress') { %>
        <button type="submit" name="status" value="in-progress" class="btn btn-outline">Mark as In Progress</button>
      <% } %>
      <% if (task.status !== 'done') { %>
        <button type="submit" name="status" value="done" class="btn btn-success">Mark as Done</button>
      <% } %>
    </form>
  </div>
</div>

<%- include('../partials/footer') %>